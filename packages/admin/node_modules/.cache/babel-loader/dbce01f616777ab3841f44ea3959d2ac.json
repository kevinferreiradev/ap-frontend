{"ast":null,"code":"import { fetchUtils } from 'react-admin';\nimport { axiosInstance } from 'services/http';\nimport { CondOperator, RequestQueryBuilder } from '@nestjsx/crud-request'; // TODO This is a uuid hack to filter works based on a uuid\n\nimport { validate as uuidValidate } from 'uuid';\nconst httpClient = fetchUtils.fetchJson;\n\nconst getMessage = error => {\n  return \"random message\";\n  const message = error.response && error.response.data && error.response.data.message;\n\n  if (!message) {\n    return error.response.statusText;\n  }\n\n  return typeof message !== 'string' ? error.response.data.message[0] : error.response.data.message;\n};\n\nconst composeFilter = paramsFilter => {\n  if (paramsFilter && (paramsFilter === '' || typeof paramsFilter.q !== 'undefined' && paramsFilter.q === '')) {\n    paramsFilter = {};\n  }\n\n  const flatFilter = fetchUtils.flattenObject(paramsFilter);\n  return Object.keys(flatFilter).map(key => {\n    const splitKey = key.split('||');\n    let field = splitKey[0];\n    let ops = splitKey[1];\n\n    if (!ops) {\n      if (typeof flatFilter[key] === 'number' || typeof flatFilter[key] === 'boolean' || flatFilter[key].match && flatFilter[key].match(/^\\d+$/) || uuidValidate(flatFilter[key])) {\n        ops = CondOperator.EQUALS;\n      } else {\n        ops = CondOperator.CONTAINS;\n      }\n    }\n\n    if (field.startsWith('_') && field.includes('.')) {\n      field = field.split(/\\.(.+)/)[1];\n    }\n\n    return {\n      field,\n      operator: ops,\n      value: flatFilter[key]\n    };\n  });\n};\n\nconst USER_MOCK = [{\n  \"id\": 1,\n  \"email\": \"User2@email.com\",\n  \"username\": \"User 1\",\n  \"firstName\": \"User 1\",\n  \"lastName\": \"User 1\"\n}, {\n  \"id\": 2,\n  \"email\": \"User2@email.com\",\n  \"username\": \"User2\",\n  \"firstName\": \"User 2\",\n  \"lastName\": \"User 2\"\n}];\nconst CATEGORY_MOCK = [{\n  \"id\": 1,\n  \"image\": \"image.png\",\n  \"code\": \"CAT_101\",\n  \"description\": \"Eletronico\"\n}, {\n  \"id\": 2,\n  \"image\": \"image.png\",\n  \"code\": \"CAT_102\",\n  \"description\": \"Animal\"\n}];\nconst STATUS_MOCK = [{\n  \"id\": 1,\n  \"code\": \"STS_100\",\n  \"description\": \"Achado\"\n}, {\n  \"id\": 2,\n  \"code\": \"STS_101\",\n  \"description\": \"Perdido\"\n}];\nconst CITIES_MOCK = [{\n  \"id\": 1,\n  \"code\": \"STS_100\",\n  \"description\": \"João Pessoa\"\n}, {\n  \"id\": 2,\n  \"code\": \"STS_101\",\n  \"description\": \"Campina Grande\"\n}];\nconst PARTNERS_MOCK = [{\n  \"id\": 1,\n  \"code\": \"STS_100\",\n  \"description\": \"Manaira Shopping\"\n}, {\n  \"id\": 2,\n  \"code\": \"STS_101\",\n  \"description\": \"Mangabeira Shopping\"\n}];\nexport const dataProvider = {\n  getList: resource => //params\n  new Promise((resolve //, reject\n  ) => {\n    let data;\n    console.log('STEP resource ', resource);\n    if (resource === \"user\") data = USER_MOCK;\n    if (resource === \"category\") data = CATEGORY_MOCK;\n    if (resource === \"status\") data = STATUS_MOCK;\n    if (resource === \"cities\") data = CITIES_MOCK;\n    if (resource === \"partners\") data = PARTNERS_MOCK; //const newResource = resource === 'users' ? 'user' : resource;\n    //console.log('STEP USER_MOCK', USER_MOCK);\n\n    return new Promise(() => resolve({\n      data: data,\n      total: 2\n    })); // const newResource = resource === 'users' ? 'user' : resource;\n    // const { page, perPage } = params.pagination;\n    // const query = RequestQueryBuilder.create({\n    //   filter: composeFilter(params.filter),\n    // })\n    //   .setLimit(perPage)\n    //   .setPage(page)\n    //   .sortBy(params.sort as QuerySort)\n    //   .setOffset((page - 1) * perPage)\n    //   .query();\n    // const url = `${newResource}?${query}`;\n    // return axiosInstance\n    //   .get(url)\n    //   .then(response =>\n    //     resolve({\n    //       data: response.data.data,\n    //       total: response.data.total,\n    //     }),\n    //   )\n    //   .catch(error => {\n    //     const message = getMessage(error);\n    //     error.message = message;\n    //     return reject(error);\n    //   });\n  }),\n  getOne: (resource, params) => axiosInstance.get(`/${resource}/${params.id}`).then(response => ({\n    data: response.data\n  })),\n  getMany: () => //  resource, params\n  new Promise(() => //  resolve, reject\n  {\n    return new Promise(resolve => resolve({\n      data: USER_MOCK,\n      total: 1\n    }));\n  }),\n  // new Promise((resolve, reject) => {\n  //   const query = RequestQueryBuilder.create()\n  //     .setFilter({\n  //       field: 'id',\n  //       operator: CondOperator.IN,\n  //       value: `${params.ids}`,\n  //     })\n  //     .query();\n  //   const url = `${resource}?${query}`;\n  //   return axiosInstance\n  //     .get(url)\n  //     .then(response =>\n  //       resolve({\n  //         data: response.data.data,\n  //       }),\n  //     )\n  //     .catch(error => {\n  //       const message = getMessage(error);\n  //       error.message = message;\n  //       return reject(error);\n  //     });\n  // }),\n  getManyReference: (resource, params) => new Promise((resolve, reject) => {\n    const {\n      page,\n      perPage\n    } = params.pagination;\n    const filter = composeFilter({});\n\n    if (params.id && params.target) {\n      filter.push({\n        field: params.target,\n        operator: CondOperator.EQUALS,\n        value: params.id\n      });\n    }\n\n    const query = RequestQueryBuilder.create({\n      filter\n    }).sortBy(params.sort).setLimit(perPage).setOffset((page - 1) * perPage).query();\n    const url = `${resource}?${query}`;\n    return axiosInstance.get(url).then(({\n      data\n    }) => resolve({\n      data: data.data,\n      total: data.total\n    })).catch(error => {\n      const message = getMessage(error);\n      error.message = message;\n      return reject(error);\n    });\n  }),\n  update: (resource, params) => new Promise((resolve, reject) => axiosInstance.patch(`${resource}/${params.id}`, params.data).then(response => resolve({\n    data: response.data\n  })).catch(error => {\n    const message = getMessage(error);\n    error.message = message;\n    return reject(error);\n  })),\n  updateMany: (resource, params) => {\n    return httpClient(`${resource}`, {\n      method: 'PUT',\n      body: JSON.stringify(params.data)\n    }).then(({\n      json\n    }) => ({\n      data: json\n    }));\n  },\n  create: (resource, params) => new Promise((resolve, reject) => axiosInstance.post(`${resource}`, params.data).then(response => resolve({\n    data: response.data\n  })).catch(error => {\n    const message = getMessage(error);\n    error.message = message;\n    return reject(error);\n  })),\n  delete: (resource, params) => new Promise((resolve, reject) => axiosInstance.delete(`${resource}/${params.id}`).then(({\n    data\n  }) => resolve({\n    data\n  })).catch(error => {\n    const message = getMessage(error);\n    error.message = message;\n    return reject(error);\n  })),\n  deleteMany: (resource, params) => {\n    return new Promise((resolve, reject) => {\n      return Promise.all(params.ids.map(id => axiosInstance.delete(`${resource}/${id}`))).then(responses => resolve({\n        data: responses.map(response => response.data)\n      })).catch(error => {\n        const message = getMessage(error);\n        error.message = message;\n        return reject(error);\n      });\n    });\n  }\n};\nexport default dataProvider;","map":{"version":3,"sources":["/Users/thiagoramalho/Documents/Thiago/Workspace/Firestorm/ap-admin/packages/admin/src/providers/dataProvider.ts"],"names":["fetchUtils","axiosInstance","CondOperator","RequestQueryBuilder","validate","uuidValidate","httpClient","fetchJson","getMessage","error","message","response","data","statusText","composeFilter","paramsFilter","q","flatFilter","flattenObject","Object","keys","map","key","splitKey","split","field","ops","match","EQUALS","CONTAINS","startsWith","includes","operator","value","USER_MOCK","CATEGORY_MOCK","STATUS_MOCK","CITIES_MOCK","PARTNERS_MOCK","dataProvider","getList","resource","Promise","resolve","console","log","total","getOne","params","get","id","then","getMany","getManyReference","reject","page","perPage","pagination","filter","target","push","query","create","sortBy","sort","setLimit","setOffset","url","catch","update","patch","updateMany","method","body","JSON","stringify","json","post","delete","deleteMany","all","ids","responses"],"mappings":"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","sourcesContent":["import { fetchUtils, DataProvider } from 'react-admin';\nimport { axiosInstance } from 'services/http';\nimport {\n  CondOperator,\n  QueryFilter,\n  QuerySort,\n  RequestQueryBuilder,\n} from '@nestjsx/crud-request';\n// TODO This is a uuid hack to filter works based on a uuid\nimport { validate as uuidValidate } from 'uuid';\n\nconst httpClient = fetchUtils.fetchJson;\n\nconst getMessage = (error: any) => {\n  return \"random message\";\n\n\n  const message =\n    error.response && error.response.data && error.response.data.message;\n  if (!message) {\n    return error.response.statusText;\n  }\n  return typeof message !== 'string'\n    ? error.response.data.message[0]\n    : error.response.data.message;\n};\nconst composeFilter = (paramsFilter: any): QueryFilter[] => {\n  if (\n    paramsFilter &&\n    (paramsFilter === '' ||\n      (typeof paramsFilter.q !== 'undefined' && paramsFilter.q === ''))\n  ) {\n    paramsFilter = {};\n  }\n\n  const flatFilter = fetchUtils.flattenObject(paramsFilter);\n  return Object.keys(flatFilter).map(key => {\n    const splitKey = key.split('||');\n\n    let field = splitKey[0];\n    let ops = splitKey[1];\n    if (!ops) {\n      if (\n        typeof flatFilter[key] === 'number' ||\n        typeof flatFilter[key] === 'boolean' ||\n        (flatFilter[key].match && flatFilter[key].match(/^\\d+$/)) ||\n        uuidValidate(flatFilter[key])\n      ) {\n        ops = CondOperator.EQUALS;\n      } else {\n        ops = CondOperator.CONTAINS;\n      }\n    }\n\n    if (field.startsWith('_') && field.includes('.')) {\n      field = field.split(/\\.(.+)/)[1];\n    }\n    return { field, operator: ops, value: flatFilter[key] } as QueryFilter;\n  });\n};\n\nconst USER_MOCK = [{\n  \"id\": 1,\n  \"email\": \"User2@email.com\",\n  \"username\": \"User 1\",\n  \"firstName\": \"User 1\",\n  \"lastName\": \"User 1\",\n  \n},{\n  \"id\": 2,\n  \"email\": \"User2@email.com\",\n  \"username\": \"User2\",\n  \"firstName\": \"User 2\",\n  \"lastName\": \"User 2\",\n  \n}];\n\nconst CATEGORY_MOCK = [{\n  \"id\": 1,\n  \"image\": \"image.png\",\n  \"code\": \"CAT_101\",\n  \"description\": \"Eletronico\"\n},{\n  \"id\": 2,\n  \"image\": \"image.png\",\n  \"code\": \"CAT_102\",\n  \"description\": \"Animal\",\n}];\n\nconst STATUS_MOCK = [{\n  \"id\": 1,\n  \"code\": \"STS_100\",\n  \"description\": \"Achado\"\n},{\n  \"id\": 2,\n  \"code\": \"STS_101\",\n  \"description\": \"Perdido\",\n  }];\n\n\nconst CITIES_MOCK = [{\n  \"id\": 1,\n  \"code\": \"STS_100\",\n  \"description\": \"João Pessoa\"\n},{\n  \"id\": 2,\n  \"code\": \"STS_101\",\n  \"description\": \"Campina Grande\",\n}];\n\n\nconst PARTNERS_MOCK = [{\n  \"id\": 1,\n  \"code\": \"STS_100\",\n  \"description\": \"Manaira Shopping\"\n},{\n  \"id\": 2,\n  \"code\": \"STS_101\",\n  \"description\": \"Mangabeira Shopping\",\n}];\n\n\nexport const dataProvider: DataProvider = {\n  getList: (\n    resource,\n    //params\n  ) =>\n    new Promise((\n      resolve\n      //, reject\n    ) => {\n      \n      let data: any[];\n      \n      console.log('STEP resource ', resource);\n      if (resource === \"user\")\n        data = USER_MOCK;\n      \n      if (resource === \"category\")\n        data = CATEGORY_MOCK;\n      \n      if (resource === \"status\")\n        data = STATUS_MOCK;\n      \n      if (resource === \"cities\")\n        data = CITIES_MOCK;\n      \n      if (resource === \"partners\")\n        data = PARTNERS_MOCK;\n\n        \n      \n      \n      //const newResource = resource === 'users' ? 'user' : resource;\n      //console.log('STEP USER_MOCK', USER_MOCK);\n      return new Promise(() =>\n        resolve({\n          data: data,\n          total: 2\n        })\n      )\n    \n\n      // const newResource = resource === 'users' ? 'user' : resource;\n      // const { page, perPage } = params.pagination;\n      // const query = RequestQueryBuilder.create({\n      //   filter: composeFilter(params.filter),\n      // })\n      //   .setLimit(perPage)\n      //   .setPage(page)\n      //   .sortBy(params.sort as QuerySort)\n      //   .setOffset((page - 1) * perPage)\n      //   .query();\n      // const url = `${newResource}?${query}`;\n      // return axiosInstance\n      //   .get(url)\n      //   .then(response =>\n      //     resolve({\n      //       data: response.data.data,\n      //       total: response.data.total,\n      //     }),\n      //   )\n      //   .catch(error => {\n      //     const message = getMessage(error);\n\n      //     error.message = message;\n      //     return reject(error);\n      //   });\n  }),\n  getOne: (resource, params) =>\n    axiosInstance.get(`/${resource}/${params.id}`).then(response => ({\n      data: response.data,\n    })),\n  getMany: (\n  //  resource, params\n  ) =>\n    new Promise((\n    //  resolve, reject\n    ) => {\n      return new Promise((resolve) =>\n        resolve({\n          data: USER_MOCK,\n          total: 1\n        })\n      )\n    }),\n    // new Promise((resolve, reject) => {\n    //   const query = RequestQueryBuilder.create()\n    //     .setFilter({\n    //       field: 'id',\n    //       operator: CondOperator.IN,\n    //       value: `${params.ids}`,\n    //     })\n    //     .query();\n    //   const url = `${resource}?${query}`;\n\n    //   return axiosInstance\n    //     .get(url)\n    //     .then(response =>\n    //       resolve({\n    //         data: response.data.data,\n    //       }),\n    //     )\n    //     .catch(error => {\n    //       const message = getMessage(error);\n\n    //       error.message = message;\n    //       return reject(error);\n    //     });\n    // }),\n  getManyReference: (resource, params) =>\n    new Promise((resolve, reject) => {\n      const { page, perPage } = params.pagination;\n      const filter: QueryFilter[] = composeFilter({});\n      if (params.id && params.target) {\n        filter.push({\n          field: params.target,\n          operator: CondOperator.EQUALS,\n          value: params.id,\n        });\n      }\n\n      const query = RequestQueryBuilder.create({\n        filter,\n      })\n        .sortBy(params.sort as QuerySort)\n        .setLimit(perPage)\n        .setOffset((page - 1) * perPage)\n        .query();\n\n      const url = `${resource}?${query}`;\n      return axiosInstance\n        .get(url)\n        .then(({ data }) =>\n          resolve({\n            data: data.data,\n            total: data.total,\n          }),\n        )\n        .catch(error => {\n          const message = getMessage(error);\n\n          error.message = message;\n          return reject(error);\n        });\n    }),\n  update: (resource, params) =>\n    new Promise((resolve, reject) =>\n      axiosInstance\n        .patch(`${resource}/${params.id}`, params.data)\n        .then(response =>\n          resolve({\n            data: response.data,\n          }),\n        )\n        .catch(error => {\n          const message = getMessage(error);\n\n          error.message = message;\n          return reject(error);\n        }),\n    ),\n  updateMany: (resource, params) => {\n    return httpClient(`${resource}`, {\n      method: 'PUT',\n      body: JSON.stringify(params.data),\n    }).then(({ json }) => ({ data: json }));\n  },\n  create: (resource, params) =>\n    new Promise((resolve, reject) =>\n      axiosInstance\n        .post(`${resource}`, params.data)\n        .then(response =>\n          resolve({\n            data: response.data,\n          }),\n        )\n        .catch(error => {\n          const message = getMessage(error);\n\n          error.message = message;\n          return reject(error);\n        }),\n    ),\n  delete: (resource, params) =>\n    new Promise((resolve, reject) =>\n      axiosInstance\n        .delete(`${resource}/${params.id}`)\n        .then(({ data }) => resolve({ data }))\n        .catch(error => {\n          const message = getMessage(error);\n\n          error.message = message;\n          return reject(error);\n        }),\n    ),\n  deleteMany: (resource, params) => {\n    return new Promise((resolve, reject) => {\n      return Promise.all(\n        params.ids.map(id => axiosInstance.delete(`${resource}/${id}`)),\n      )\n        .then(responses =>\n          resolve({ data: responses.map(response => response.data) }),\n        )\n        .catch(error => {\n          const message = getMessage(error);\n\n          error.message = message;\n          return reject(error);\n        });\n    });\n  },\n};\n\nexport default dataProvider;\n"]},"metadata":{},"sourceType":"module"}